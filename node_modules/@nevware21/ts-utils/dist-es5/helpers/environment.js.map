{"version":3,"file":"environment.js","sourceRoot":"","sources":["../../src/helpers/environment.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * @nevware21/ts-utils\r\n * https://github.com/nevware21/ts-utils\r\n *\r\n * Copyright (c) 2022 Nevware21\r\n * Licensed under the MIT license.\r\n */\r\n\r\nimport { NULL_VALUE, UNDEF_VALUE } from \"../internal/constants\";\r\nimport { _getGlobalValue } from \"../internal/global\";\r\nimport { ILazyValue, _globalLazyTestHooks, _initTestHooks, getLazy } from \"./lazy\";\r\nimport { ICachedValue, createCachedValue } from \"./cache\";\r\nimport { safe } from \"./safe\";\r\n\r\nconst WINDOW = \"window\";\r\n\r\ndeclare let WorkerGlobalScope: any;\r\ndeclare let self: any;\r\n\r\nlet _cachedGlobal: ICachedValue<Window>;\r\n\r\nlet _cachedWindow: ICachedValue<Window>;\r\nlet _cachedDocument: ICachedValue<Document>;\r\nlet _cachedNavigator: ICachedValue<Navigator>;\r\nlet _cachedHistory: ICachedValue<History>;\r\nlet _isWebWorker: ICachedValue<boolean>;\r\nlet _isNode: ICachedValue<boolean>;\r\n\r\n/**\r\n * Create and return an readonly {@link ILazyValue} instance which will cache and return the named global\r\n * value if available, will return `null` if the named global object is not available or if the runtime\r\n * throws an exception when attempting to access the global object.\r\n * Unlike {@link getInst} the value is cached after the first access, so if the global value changes after\r\n * the initial fetch the original cached value is still returned.\r\n * @since 0.9.5\r\n * @group Environment\r\n * @group Lazy\r\n * @group Safe\r\n * @param name The name of the global object to get, may be any valid PropertyKey (string, number or symbol)\r\n * @returns A new readonly {@link ILazyValue} instance which will lazily attempt to return the globally\r\n * available named instance.\r\n * @example\r\n * ```ts\r\n * // This does not cause the evaluation to occur\r\n * window.myGlobal = \"Hello\";\r\n * let cachedValue = lazySafeGetInst(\"myGlobal\");\r\n * // cachedValue.v === \"Hello\"\r\n *\r\n * window.myGlobal = \"Darkness\";\r\n * // cachedValue.v === \"Hello\"\r\n *\r\n * let promiseCls = lazySafeGetInst(\"Promise\");\r\n * // null if Promise is not supported in the runtime\r\n * // otherwise the Promise class.\r\n * ```\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function lazySafeGetInst<T>(name: string | number | symbol) : ILazyValue<T> {\r\n    return getLazy(() => safe(getInst<T>, [name]).v || UNDEF_VALUE);\r\n}\r\n\r\n/**\r\n * Returns the current global scope object, for a normal web page this will be the current\r\n * window, for a Web Worker this will be current worker global scope via \"self\". The internal\r\n * implementation returns the first available instance object in the following order\r\n * - globalThis (New standard)\r\n * - self (Will return the current window instance for supported browsers)\r\n * - window (fallback for older browser implementations)\r\n * - global (NodeJS standard)\r\n * - <null> (When all else fails)\r\n * While the return type is a Window for the normal case, not all environments will support all\r\n * of the properties or functions. And this caches the lookup of the global as in some environments\r\n * this can be an expensive operation.\r\n * @group Environment\r\n * @param useCached - [Optional] used for testing to bypass the cached lookup, when `true` this will\r\n * cause the cached global to be reset.\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function getGlobal(useCached?: boolean): Window {\r\n    !_globalLazyTestHooks && _initTestHooks();\r\n    (!_cachedGlobal || useCached === false || _globalLazyTestHooks.lzy) && (_cachedGlobal = createCachedValue(safe(_getGlobalValue).v || NULL_VALUE));\r\n\r\n    return _cachedGlobal.v;\r\n}\r\n\r\n/**\r\n * Return the named global object if available, will return null if the object is not available.\r\n * @group Environment\r\n * @param name The globally named object, may be any valid property key (string, number or symbol)\r\n * @param useCached - [Optional] used for testing to bypass the cached lookup, when `true` this will\r\n * cause the cached global to be reset.\r\n * @example\r\n * ```ts\r\n * // This does not cause the evaluation to occur\r\n * window.myGlobal = \"Hello\";\r\n * let cachedValue = getInst(\"myGlobal\");\r\n * // cachedValue === \"Hello\"\r\n *\r\n * window.myGlobal = \"Darkness\";\r\n * // getInst(\"myGlobal\") === \"Darkness\"\r\n *\r\n * let promiseCls = getInst(\"Promise\");\r\n * // May throw if the global is not supported by the runtime\r\n * // otherwise the Promise class.\r\n * ```\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function getInst<T>(name: string | number | symbol, useCached?: boolean): T | null {\r\n    const gbl = (!_cachedGlobal || useCached === false) ? getGlobal(useCached) : _cachedGlobal.v;\r\n    if (gbl && gbl[name]) {\r\n        return gbl[name] as T;\r\n    }\r\n\r\n    // Test workaround, for environments where <global>.window (when global == window) doesn't return the base window\r\n    if (name === WINDOW && _cachedWindow) {\r\n        // tslint:disable-next-line: no-angle-bracket-type-assertion\r\n        return <any>_cachedWindow.v as T;\r\n    }\r\n\r\n    return NULL_VALUE;\r\n}\r\n\r\n/**\r\n * Identify whether the runtime contains a `document` object\r\n * @group Environment\r\n * @returns - True if a `document` exists\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function hasDocument(): boolean {\r\n    return !!getDocument();\r\n}\r\n\r\n/**\r\n * Return the global `document` instance.\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function getDocument(): Document {\r\n    !_globalLazyTestHooks && _initTestHooks();\r\n    (!_cachedDocument || _globalLazyTestHooks.lzy) && (_cachedDocument = createCachedValue(safe(getInst<Document>, [\"document\"]).v));\r\n\r\n    return _cachedDocument.v;\r\n}\r\n\r\n/**\r\n * Identify whether the runtime contains a `window` object\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function hasWindow(): boolean {\r\n    return !!getWindow();\r\n}\r\n\r\n/**\r\n * Return the global `window` instance.\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function getWindow(): Window {\r\n    !_globalLazyTestHooks && _initTestHooks();\r\n    (!_cachedWindow || _globalLazyTestHooks.lzy) && (_cachedWindow = createCachedValue(safe(getInst<Window>, [WINDOW]).v));\r\n\r\n    return _cachedWindow.v;\r\n}\r\n\r\n/**\r\n * Identify whether the runtimne contains a `navigator` object\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function hasNavigator(): boolean {\r\n    return !!getNavigator();\r\n}\r\n\r\n/**\r\n * Returns the global `navigator` instance\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function getNavigator(): Navigator {\r\n    !_globalLazyTestHooks && _initTestHooks();\r\n    (!_cachedNavigator || _globalLazyTestHooks.lzy) && (_cachedNavigator = createCachedValue(safe(getInst<Navigator>, [\"navigator\"]).v));\r\n\r\n    return _cachedNavigator.v;\r\n}\r\n\r\n/**\r\n * Identifies whether the runtime contains a `history` object\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function hasHistory(): boolean {\r\n    return !!getHistory();\r\n}\r\n\r\n/**\r\n * Returns the global `history` instance\r\n * @group Environment\r\n * @returns\r\n */\r\n/*#__NO_SIDE_EFFECTS__*/\r\nexport function getHistory(): History | null {\r\n    !_globalLazyTestHooks && _initTestHooks();\r\n    (!_cachedHistory || _globalLazyTestHooks.lzy) && (_cachedHistory = createCachedValue(safe(getInst<History>, [\"history\"]).v));\r\n\r\n    return _cachedHistory.v;\r\n}\r\n\r\n/**\r\n * Simple method to determine if we are running in a node environment\r\n * @group Environment\r\n * @returns True if you are\r\n */\r\nexport function isNode(): boolean {\r\n    !_isNode && (_isNode = createCachedValue(!!safe(() => (process && (process.versions||{}).node)).v));\r\n\r\n    return _isNode.v;\r\n}\r\n\r\n/**\r\n * Helper to identify if you are running as a Dedicated, Shared or Service worker\r\n * @group Environment\r\n * @returns True if the environment you are in looks like a Web Worker\r\n */\r\nexport function isWebWorker(): boolean {\r\n    !_isWebWorker && (_isWebWorker = createCachedValue(!!safe(() => self && self instanceof WorkerGlobalScope).v));\r\n\r\n    return _isWebWorker.v;\r\n}\r\n"]}